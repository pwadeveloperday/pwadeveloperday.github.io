<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#ffffff" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-title" content="中国 PWA 开发者日" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<link rel="icon" href="/images/icons/icon_32.png" type="image/x-icon" />
		<link rel="manifest" href="/manifest.json" />
		
		<meta http-equiv="content-security-policy" content=""><title>Web 通用传感器 (Generic Sensors) | 中国 PWA 开发者日 | China PWA Developer Day</title><meta data-key="description" name="description" content="今天，传感器数据被用于许多原生应用程序，以实现诸如沉浸式游戏，健身追踪，AR，VR 等用例。如果能有一个 Web 传感器 API 去缩小原生和 Web 应用程序之间的差距是不是很酷？Generic Sensor API，就是为 Web 而诞生的！Generic Sensor API 提供了一套接口把传感器设备暴露到 Web 平台。该 API 由基础 Sensor 接口和一组构建于上方的具体传感器类组成。拥有基础接口可以简化具体传感器类的实现和规范流程。" data-svelte="svelte-19e34k"><meta property="og:type" content="article" data-svelte="svelte-19e34k"><meta property="og:title" content="Web 通用传感器 (Generic Sensors)" data-svelte="svelte-19e34k"><meta name="twitter:title" content="Web 通用传感器 (Generic Sensors)" data-svelte="svelte-19e34k"><meta property="og:description" content="今天，传感器数据被用于许多原生应用程序，以实现诸如沉浸式游戏，健身追踪，AR，VR 等用例。如果能有一个 Web 传感器 API 去缩小原生和 Web 应用程序之间的差距是不是很酷？Generic Sensor API，就是为 Web 而诞生的！Generic Sensor API 提供了一套接口把传感器设备暴露到 Web 平台。该 API 由基础 Sensor 接口和一组构建于上方的具体传感器类组成。拥有基础接口可以简化具体传感器类的实现和规范流程。" data-svelte="svelte-19e34k"><meta name="twitter:description" content="今天，传感器数据被用于许多原生应用程序，以实现诸如沉浸式游戏，健身追踪，AR，VR 等用例。如果能有一个 Web 传感器 API 去缩小原生和 Web 应用程序之间的差距是不是很酷？Generic Sensor API，就是为 Web 而诞生的！Generic Sensor API 提供了一套接口把传感器设备暴露到 Web 平台。该 API 由基础 Sensor 接口和一组构建于上方的具体传感器类组成。拥有基础接口可以简化具体传感器类的实现和规范流程。" data-svelte="svelte-19e34k"><meta property="og:image:width" content="16" data-svelte="svelte-19e34k"><meta property="og:image:height" content="9" data-svelte="svelte-19e34k">
	<link href="../_app/immutable/assets/_layout-afb4d7be.css" rel="stylesheet">
	<link rel="modulepreload" href="../_app/immutable/start-7b703474.js">
	<link rel="modulepreload" href="../_app/immutable/chunks/index-148df3e2.js">
	<link rel="modulepreload" href="../_app/immutable/chunks/singletons-4ce4450c.js">
	<link rel="modulepreload" href="../_app/immutable/chunks/index-56c348ce.js">
	<link rel="modulepreload" href="../_app/immutable/components/pages/_layout.svelte-1116054f.js">
	<link rel="modulepreload" href="../_app/immutable/chunks/config-d046e51a.js">
	<link rel="modulepreload" href="../_app/immutable/modules/pages/_layout.js-f214614a.js">
	<link rel="modulepreload" href="../_app/immutable/chunks/_layout-127e3191.js">
	<link rel="modulepreload" href="../_app/immutable/components/pages/blog/_post_/_page.svelte-8db79304.js">
		<!-- You can replace this block to update the Google fonts used in the project -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-QEPH34BB0N"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'G-QEPH34BB0N');
 		</script>

		<!-- You can add global <meta> tags here, but anything not global or dynamic should be a `<svelte:head>` tag on the proper page(s) instead. -->
	</head>
	<body>
		<div id="svelte">







<div class="layout"><a class="skip-to-content-link" href="#main">Skip to main content
</a>

<header><div class="topnav"><a href="/" class="site-title"><div class="logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1952" height="734.935" baseProfile="full" enable-background="new 0 0 1952 734.93" version="1.1" viewBox="0 0 1952 734.93" xml:space="preserve"><g><path fill="rgba(255, 255, 255, 0.9)" fill-opacity="1" stroke-linejoin="round" stroke-width=".2" d="M 1436.62,603.304L 1493.01,460.705L 1655.83,460.705L 1578.56,244.39L 1675.2,0.000528336L 1952,734.933L 1747.87,734.933L 1700.57,603.304L 1436.62,603.304 Z"></path><path fill="rgba(255, 255, 255, 0.9)" fill-opacity="1" stroke-linejoin="round" stroke-width=".2" d="M 1262.47,734.935L 1558.79,0.00156593L 1362.34,0.0025425L 1159.64,474.933L 1015.5,0.00351906L 864.499,0.00351906L 709.731,474.933L 600.585,258.517L 501.812,562.819L 602.096,734.935L 795.427,734.935L 935.284,309.025L 1068.63,734.935L 1262.47,734.935 Z"></path><path fill="rgba(255, 255, 255, 0.9)" fill-opacity="1" stroke-linejoin="round" stroke-width=".2" d="M 186.476,482.643L 307.479,482.643C 344.133,482.643 376.772,478.552 405.396,470.37L 436.689,373.962L 524.148,104.516C 517.484,93.9535 509.876,83.9667 501.324,74.5569C 456.419,24.852 390.719,0.000406265 304.222,0.000406265L -3.8147e-006,0.000406265L -3.8147e-006,734.933L 186.476,734.933L 186.476,482.643 Z M 346.642,169.079C 364.182,186.732 372.951,210.355 372.951,239.95C 372.951,269.772 365.238,293.424 349.813,310.906C 332.903,330.331 301.766,340.043 256.404,340.043L 186.476,340.043L 186.476,142.598L 256.918,142.598C 299.195,142.598 329.103,151.425 346.642,169.079 Z"></path></g></svg></div>
			<div class="logotitle"><div class="chn">中国</div>
				<div>PWA 开发者日</div></div></a>
		
<nav class="main-nav"><ul><li><a href="/2022" aria-current="false">2022
		</a></li><li><a href="/2021" aria-current="false">2021
		</a></li><li><a href="/app" aria-current="false">应用
		</a></li><li><a href="/blog" aria-current="page" class="active">Blog
		</a></li></ul></nav></div></header>
	<main id="main" tabindex="-1">





<div class="page"><article class="post"><h1>Web 通用传感器 (Generic Sensors)</h1>
		
		<div class="meta"><b>发布日期:</b> 2018-04-08	<b>最近更新:</b> 2022-07-06</div>

		<img class="cover-image" src="/images/blog/20220706/4.png" alt="" style="aspect-ratio: 16 / 9;" width="16" height="9">

		<!-- HTML_TAG_START --><strong>英特尔 SATG Web 团队一直致力于推进和实现 Web 前沿技术以及在 W3C 的标准化。</strong>
<p>今天，传感器数据被用于许多原生应用程序，以实现诸如沉浸式游戏，健身追踪，AR，VR 等用例。如果能有一个 Web 传感器 API 去缩小原生和 Web 应用程序之间的差距是不是很酷？Generic Sensor API，就是为 Web 而诞生的！</p>
<p>什么是 Generic Sensor API?</p>
<p>Generic Sensor API 提供了一套接口把传感器设备暴露到 Web 平台。该 API 由基础 Sensor 接口和一组构建于上方的具体传感器类组成。拥有基础接口可以简化具体传感器类的实现和规范流程。比如你可以看一下 Gyroscope 类，它非常的简短！核心功能由基础 Sensor 接口提供，Gyroscope 类仅用了三个代表角速度的属性扩展它。通常，具体的传感器类代表平台上的实际传感器，例如加速计或陀螺仪。但是，在某些情况下，传感器类的实现会融合来自多个平台传感器的数据，并以便捷的方式向用户展示结果。例如，AbsoluteOrientation 传感器基于从加速度计，陀螺仪和磁力计获得的数据提供即用型 4x4 旋转矩阵。</p>
<p>您可能认为 Web 平台已经提供了一些传感器数据接口，例如，DeviceMotion 和 DeviceOrientation 事件暴露运动传感器数据，还有一些其他实验性 API 提供来自环境传感器的数据。那么，为什么我们还需要这个新的 API 呢？</p>
<p>与现有传感器接口相比，Generic Sensor API 有许多优势：</p>
<ul><li>Generic Sensor API 是一个传感器框架，可以使用新的传感器类轻松扩展，并且每个类都将保留通用接口。为一种传感器类型编写的客户端代码可以重新用于另一种，只需很少的修改！</li>
<li>您可以配置传感器，例如，设置适合您应用需求的采样频率。</li>
<li>您可以检测平台上是否有对应传感器。</li>
<li>传感器读数具有高精度时间戳，可以更好地与应用程序中的其他活动同步。</li>
<li>传感器数据模型和坐标系统明确定义，允许浏览器供应商实现可互操作的解决方案。</li>
<li>Generic Sensor 的基础接口没有绑定到 DOM（Navigator 和 Window 对象），为将来在 Service Workers 中使用相同的 API 或在 Headless JS 运行时实现 Generic Sensor API（例如在嵌入式设备上）开辟了的机会。</li>
<li>与传统的传感器API相比，安全性和隐私方面是 Generic Sensor API 的首要任务，并且提供了更好的安全级别。目前已经集成了 Permissions API。</li>
<li>自动的屏幕坐标同步目前可于 Accelerometer，Gyroscope，LinearAccelerationSensor，AbsoluteOrientationSensor，RelativeOrientationSensor和Magnetometer。</li></ul>
<p>Chrome 支持以下几种传感器。</p>
<h2 id="运动传感器motion-sensors"><a aria-hidden="true" tabindex="-1" href="#运动传感器motion-sensors"><span class="icon icon-link"></span></a>运动传感器（Motion sensors）</h2>
<ul><li>加速度计（Accelerometer）</li>
<li>陀螺仪（Gyroscope)</li>
<li>线性加速度传感器（LinearAccelerationSensor）</li>
<li>绝对方向传感器（AbsoluteOrientationSensor）</li>
<li>相对方向传感器（RelativeOrientationSensor）</li></ul>
<h2 id="环境传感器environmental-sensors"><a aria-hidden="true" tabindex="-1" href="#环境传感器environmental-sensors"><span class="icon icon-link"></span></a>环境传感器（Environmental sensors）</h2>
<ul><li>环境光传感器（AmbientLightSensor）</li>
<li>磁力计（Magnetometer）</li></ul>
<p>您可以通过打开功能标志 chrome://flags/#enable-generic-sensor-extra-classes 来启用环境传感器API以用于开发目的。</p>
<p>如需了解浏览器实现状态的更多信息，请访问 <a href="https://chromestatus.com/feature/5298357018820608" rel="nofollow">chromestatus.com</a>。</p>
<h2 id="这些传感器是什么我们如何使用它们"><a aria-hidden="true" tabindex="-1" href="#这些传感器是什么我们如何使用它们"><span class="icon icon-link"></span></a>这些传感器是什么？我们如何使用它们？</h2>
<p>传感器是一个相当特殊的领域，可能需要简单介绍。如果您熟悉传感器，则可以直接跳到开始编码章节。否则，我们来详细了解每个支持的传感器。</p>
<h2 id="加速度和线性加速度"><a aria-hidden="true" tabindex="-1" href="#加速度和线性加速度"><span class="icon icon-link"></span></a>加速度和线性加速度</h2>
<p><img src="/images/blog/20220706/1.gif" alt="测量加速度传感器"></p>
<p>图1: 测量加速度传感器</p>
<p>加速度传感器测量三个轴（X，Y 和 Z）上承载传感器的设备的加速度。这个传感器是一个惯性传感器，这意味着当设备处于线性自由落体时，总测得的加速度为 0m/s2，当一个设备平躺在桌子上时，向上方向（Z轴）的加速度将会等于地球的重力，即 g≈+9.8m/s2，因为它测量的是桌子向上推动设备的力。如果将设备推向右侧，则X轴上的加速度为正，如果设备从右侧加速至左侧，则加速度为负。</p>
<p>加速度计可用于如下步骤：步数计算，动作感应或简单的设备定向。通常情况下，加速度计测量结合其他来源的数据，以创建融合传感器，如方向传感器。</p>
<p>线性加速度传感器测量装置传感器的设备的加速度，不包括的重力的作用。例如，当设备处于静止状态时，传感器在三个轴上测量的加速度 ≈0m/2。</p>
<h2 id="陀螺仪"><a aria-hidden="true" tabindex="-1" href="#陀螺仪"><span class="icon icon-link"></span></a>陀螺仪</h2>
<p><img src="/images/blog/20220706/2.gif" alt="测量陀螺仪传感器"></p>
<p>图2: 测量陀螺仪传感器</p>
<p>陀螺仪传感器测量设备在偏转，倾斜时相对于 X，Y 和 Z 轴的角速度（rad/s）。大多数消费类设备都有机械（MEMS）陀螺仪，它们是基于惯性科里奥利力来测量旋转速率的惯性传感器。MEMS 陀螺仪容易产生漂移，这是由传感器的重力灵敏度引起的，这会使传感器的内部机械系统变形。陀螺仪以相对高的频率振荡，例如 10kHz，因此与其他传感器相比可能消耗更多的功率。</p>
<h2 id="方向传感器"><a aria-hidden="true" tabindex="-1" href="#方向传感器"><span class="icon icon-link"></span></a>方向传感器</h2>
<p><img src="/images/blog/20220706/3.gif" alt="测量绝对方向传感器"></p>
<p>图3: 测量绝对方向传感器</p>
<p>绝对方向传感器是一种的融合传感器，测量设备相对于地球坐标系的旋转，而相对方向传感器则提供设备相对于固定的参考坐标系统的旋转数据。</p>
<p>所有现代 3D JavaScript 框架均支持四元数和旋转矩阵来表示旋转。但是，如果你直接使用 WebGL，方向传感器接口提供了便捷的方法用于 WebGL 兼容的旋转矩阵。这里有几个代码示例：</p>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js">three<span class="token punctuation">.</span>js

<span class="token keyword">let</span> torusGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TorusGeometry</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1.6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x0071C5</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> torus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>torusGeometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>torus<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用四元数更新网格旋转。</span>
<span class="token keyword">const</span> sensorAbs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbsoluteOrientationSensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sensorAbs<span class="token punctuation">.</span><span class="token function-variable function">onreading</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> torus<span class="token punctuation">.</span>quaternion<span class="token punctuation">.</span><span class="token function">fromArray</span><span class="token punctuation">(</span>sensorAbs<span class="token punctuation">.</span>quaternion<span class="token punctuation">)</span><span class="token punctuation">;</span>
sensorAbs<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用旋转矩阵更新网格旋转。</span>
<span class="token keyword">const</span> sensorRel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RelativeOrientationSensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> rotationMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sensor_rel<span class="token punctuation">.</span><span class="token function-variable function">onreading</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  sensorRel<span class="token punctuation">.</span><span class="token function">populateMatrix</span><span class="token punctuation">(</span>rotationMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
  torus<span class="token punctuation">.</span>matrix<span class="token punctuation">.</span><span class="token function">fromArray</span><span class="token punctuation">(</span>rotationMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
sensorRel<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token constant">BABYLON</span>

<span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BABYLON<span class="token punctuation">.</span>Mesh<span class="token punctuation">.</span>CreateCylinder</span><span class="token punctuation">(</span><span class="token string">"mesh"</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sensorRel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RelativeOrientationSensor</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">frequency</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sensorRel<span class="token punctuation">.</span><span class="token function-variable function">onreading</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> mesh<span class="token punctuation">.</span>rotationQuaternion<span class="token punctuation">.</span><span class="token function">FromArray</span><span class="token punctuation">(</span>sensorRel<span class="token punctuation">.</span>quaternion<span class="token punctuation">)</span><span class="token punctuation">;</span>
sensorRel<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js">WebGL

<span class="token comment">// 当有新的读数时，初始化传感器和更新模型矩阵。</span>
<span class="token keyword">let</span> modMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sensorAbs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbsoluteOrientationSensor</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">frequency</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sensorAbs<span class="token punctuation">.</span><span class="token function-variable function">onreading</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> sensorAbs<span class="token punctuation">.</span><span class="token function">populateMatrix</span><span class="token punctuation">(</span>modMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
sensorAbs<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Somewhere in rendering code, update vertex shader attribute for the model</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>modMatrixAttr<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre>
<p>方向传感器支持各种用例，如沉浸式游戏，AR 和 VR。</p>
<p>如果你想了解运动传感器的更多信息，比如高级用例和需求说明等，请参考运动传感器解释文档。</p>
<h2 id="屏幕坐标系同步"><a aria-hidden="true" tabindex="-1" href="#屏幕坐标系同步"><span class="icon icon-link"></span></a>屏幕坐标系同步</h2>
<p>默认情况下，空间传感器的读数将在绑定到设备的本地坐标系中解析，并且不考虑屏幕方向。</p>
<p><img src="/images/blog/20220706/4.png" alt="设备坐标系"></p>
<p>图4: 设备坐标系</p>
<p>但是，许多使用案例（如游戏，AR 和 VR）都需要传感器读数在绑定于屏幕方向的坐标系中解析。</p>
<p><img src="/images/blog/20220706/5.png" alt="屏幕坐标系"></p>
<p>图5: 屏幕坐标系</p>
<p>以前，传感器读数重新映射到屏幕坐标必须在 JavaScript 中实现。这种方法效率低下，并且也极大地增加了 Web 应用程序代码的复杂性：Web 应用程序必须监视屏幕方向更改并执行传感器读数的坐标转换，这对欧拉角或四元数来说并不是简单的事情。</p>
<p>Generic Sensor API 提供了更简单可靠的解决方案！本地坐标系对于所有定义的空间传感器类都是可配置的： Accelerometer、Gyroscope、LinearAccelerationSensor、AbsoluteOrientationSensor、RelativeOrientationSensor 和 Magnetometer。通过将 referenceFrame 选项传递给传感器对象构造函数，用户可以定义返回的读数是否将在设备或屏幕坐标中解析。</p>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token comment">// 当有新的读数时，初始化传感器和更新模型矩阵。</span>
<span class="token comment">// 或者,可以写成 RelativeOrientationSensor(&#123;referenceFrame: "device"&#125;).</span>
<span class="token keyword">const</span> sensorRelDevice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RelativeOrientationSensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 传感器读数在屏幕坐标系统中得到解析。不需要手动重新映射！</span>
<span class="token keyword">const</span> sensorRelScreen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RelativeOrientationSensor</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">referenceFrame</span><span class="token operator">:</span> <span class="token string">"screen"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><!-- HTML_TAG_END --></pre>
<h2 id="开始编码"><a aria-hidden="true" tabindex="-1" href="#开始编码"><span class="icon icon-link"></span></a>开始编码!</h2>
<p>Generic Sensor API 非常容易上手！Sensor 接口提供了 start() 和 stop() 方法来控制传感器状态和事件处理用于接收传感器状态，错误和新的可用的读数的通知。具体的传感器类通常将其特定的读取属性添加到基类里。</p>
<h2 id="开发环境"><a aria-hidden="true" tabindex="-1" href="#开发环境"><span class="icon icon-link"></span></a>开发环境</h2>
<p>在开发过程中，您可以通过 localhost 去使用 Sensor 接口，最简单的方法是使用 Web Server for Chrome 来为您的 Web 应用程序提供服务。如果您是在移动设备上开发，需要为本地服务器设置端口转发，然后你就可以开始编码了！</p>
<p>当您的代码准备好后，将其部署在支持 HTTPS 的服务器上。GitHub Pages 可以提供 HTTPS 服务，将是您分享 Demo 的好地方。</p>
<h2 id="3d-模型旋转"><a aria-hidden="true" tabindex="-1" href="#3d-模型旋转"><span class="icon icon-link"></span></a>3D 模型旋转</h2>
<p>在下列简单的例子中，我们使用绝对方向传感器的数据来修改 3D 模型的旋转四元数。代码中的 model 是 three.js 的 Object3D 类的一个实例，具有 quaternion 属性。手机定向 demo 中的以下代码片段解释了绝对定位传感器如何用于旋转 3D 模型。</p>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token keyword">function</span> <span class="token function">initSensor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  sensor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbsoluteOrientationSensor</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">frequency</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sensor<span class="token punctuation">.</span><span class="token function-variable function">onreading</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> model<span class="token punctuation">.</span>quaternion<span class="token punctuation">.</span><span class="token function">fromArray</span><span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>quaternion<span class="token punctuation">)</span><span class="token punctuation">;</span>
  sensor<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>error<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'NotReadableError'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Sensor is not available."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  sensor<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre>
<p>设备的方向将反映在 model 的 3D 旋转的 WebGL 场景内。</p>
<p><img src="/images/blog/20220706/6.png" alt="传感器更新3D模型的方向"></p>
<p>图6: 传感器更新 3D 模型的方向</p>
<h2 id="punchmeter"><a aria-hidden="true" tabindex="-1" href="#punchmeter"><span class="icon icon-link"></span></a>Punchmeter</h2>
<p>下面的代码片段是从 punchmeter demo 提取出来的，解释了如何使用线性加速度传感器来计算设备在初始化为静止状态的最大速度。</p>
<pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>maxSpeed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>vx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>ax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onreading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> dt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>accel<span class="token punctuation">.</span>timestamp <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">;</span> <span class="token comment">// In seconds</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>vx <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>accel<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ax<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> dt<span class="token punctuation">;</span>
  <span class="token keyword">let</span> speed <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maxSpeed <span class="token operator">&lt;</span> speed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>maxSpeed <span class="token operator">=</span> speed<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>t <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>accel<span class="token punctuation">.</span>timestamp<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>ax <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>accel<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token operator">...</span><span class="token punctuation">.</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>accel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'reading'</span><span class="token punctuation">,</span> onreading<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><!-- HTML_TAG_END --></pre>
<p>当前速度计算为近似加速度函数的积分。</p>
<p><img src="/images/blog/20220706/7.png" alt="测量冲压速度"></p>
<p>图7: 测量冲压速度</p>
<h2 id="隐私和安全"><a aria-hidden="true" tabindex="-1" href="#隐私和安全"><span class="icon icon-link"></span></a>隐私和安全</h2>
<p>传感器读数是敏感数据，可能受到来自恶意网页的各种攻击。Chrome 对 Generic Sensor API 的实现做了一些限制，以减轻潜在的安全和隐私风险。打算使用 Generic Sensor API 的开发人员必须考虑到这些限制，下面让我们简单地列出它们。</p>
<h2 id="只允许运行在-https"><a aria-hidden="true" tabindex="-1" href="#只允许运行在-https"><span class="icon icon-link"></span></a>只允许运行在 HTTPS</h2>
<p>由于 Generic Sensor API 是一项强大的功能，因此 Chrome 只允许在安全的情况下使用。实际上，这意味着要使用 Generic Sensor API，您需要通过HTTPS访问您的页面。在开发过程中，您可以通过http://localhost 进行此操作，但对于最终产品，您需要在服务器上部署 HTTPS。</p>
<h2 id="feature-policy-集成"><a aria-hidden="true" tabindex="-1" href="#feature-policy-集成"><span class="icon icon-link"></span></a>Feature Policy 集成</h2>
<p>Generic Sensor API 集成了 Feature Policy 用于控制在 frame 上访问传感器数据。</p>
<p>默认情况下，Sensor 对象只允许在主 frame 或同一个域的子 frame 内创建，从而防止未经授权的跨域 iframe 读取传感器数据。您还可以通过明确地启用或禁用相应的策略控制功能来修改此默认行为。</p>
<p>下面的代码片段说明了如何授予加速度计数据访问跨域 iframe 的权限，这意味着 Accelerometer 或 LinearAccelerationSensor 对象可以在跨域 iframe 里创建。</p>
<pre class="language-html"><!-- HTML_TAG_START --><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://third-party.com<span class="token punctuation">"</span></span> <span class="token attr-name">allow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>accelerometer<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code><!-- HTML_TAG_END --></pre>
<p>备注: Feature Policy 集成在 Chrome 65 或更高版本中。在早期版本的 Chrome 中，Sensor 对象只能在主 frame 内创建。</p>
<p>传感器读数传送可以被暂停。</p>
<p>传感器读数只能通过可见网页访问，即用户实际上正在与之交互时。而且，如果用户聚焦到跨域子 frame 传感器读数传送将会在父页面上被暂停，以防止在跨域子 frame 中的第三方软件窃取到用户信息。</p>
<p>由于 Generic Sensor 框架具有很强的可扩展性，我们可以预见更多代表各种传感器类型的新类的出现，并为 PWA 及 Web 带来更多功能。</p>
<ul><li>英文作者：Alexander Shalamov, Mikhail Pozdnyakov / 英特尔</li>
<li>译者：林万铭
</li></ul><!-- HTML_TAG_END -->

		<div class="author"><div class="authorlist"><div class="authorimage"><img src="/images/people/120/wanming.png" alt="林万铭"></div>
					<div class="authordes"><div class="name">林万铭</div>
						<div class="title">软件工程师</div>
						<div class="company">英特尔 SATG Web 平台工程</div></div></div>
			
			</div>

		<aside class="post-footer">
				<ul><li><a href="/blog/category/DevDay/">DevDay</a>
						</li><li><a href="/blog/category/PWA/">PWA</a>
						</li><li><a href="/blog/category/Fugu/">Fugu</a>
						</li><li><a href="/blog/category/Sensor/">Sensor</a>
						</li></ul></aside></article></div></main>
	<footer><div><p class="copy">©2022 <a href="https://pwadev.io">中国 PWA 开发者日</a></p>
		<p class="cp"><a href="/api/rss.xml" rel="external">RSS</a> <a href="/code-of-conduct" title="行为准则">行为</a> <a href="/privacy" title="隐私条款">隐私</a> <a href="/about" title="关于中国 PWA 开发者日">关于</a></p></div></footer></div>


		<script type="module" data-sveltekit-hydrate="k888ce">
		import { start } from "../_app/immutable/start-7b703474.js";

		start({
			env: {},
			hydrate: {
				status: 200,
				error: null,
				node_ids: [0, 8],
				params: {post:"generic-sensors"},
				routeId: "blog/[post]",
				data: (function(a,b){return [null,{type:"data",data:{PostContent:"\u003Cstrong\u003E英特尔 SATG Web 团队一直致力于推进和实现 Web 前沿技术以及在 W3C 的标准化。\u003C\u002Fstrong\u003E\n\u003Cp\u003E今天，传感器数据被用于许多原生应用程序，以实现诸如沉浸式游戏，健身追踪，AR，VR 等用例。如果能有一个 Web 传感器 API 去缩小原生和 Web 应用程序之间的差距是不是很酷？Generic Sensor API，就是为 Web 而诞生的！\u003C\u002Fp\u003E\n\u003Cp\u003E什么是 Generic Sensor API?\u003C\u002Fp\u003E\n\u003Cp\u003EGeneric Sensor API 提供了一套接口把传感器设备暴露到 Web 平台。该 API 由基础 Sensor 接口和一组构建于上方的具体传感器类组成。拥有基础接口可以简化具体传感器类的实现和规范流程。比如你可以看一下 Gyroscope 类，它非常的简短！核心功能由基础 Sensor 接口提供，Gyroscope 类仅用了三个代表角速度的属性扩展它。通常，具体的传感器类代表平台上的实际传感器，例如加速计或陀螺仪。但是，在某些情况下，传感器类的实现会融合来自多个平台传感器的数据，并以便捷的方式向用户展示结果。例如，AbsoluteOrientation 传感器基于从加速度计，陀螺仪和磁力计获得的数据提供即用型 4x4 旋转矩阵。\u003C\u002Fp\u003E\n\u003Cp\u003E您可能认为 Web 平台已经提供了一些传感器数据接口，例如，DeviceMotion 和 DeviceOrientation 事件暴露运动传感器数据，还有一些其他实验性 API 提供来自环境传感器的数据。那么，为什么我们还需要这个新的 API 呢？\u003C\u002Fp\u003E\n\u003Cp\u003E与现有传感器接口相比，Generic Sensor API 有许多优势：\u003C\u002Fp\u003E\n\u003Cul\u003E\u003Cli\u003EGeneric Sensor API 是一个传感器框架，可以使用新的传感器类轻松扩展，并且每个类都将保留通用接口。为一种传感器类型编写的客户端代码可以重新用于另一种，只需很少的修改！\u003C\u002Fli\u003E\n\u003Cli\u003E您可以配置传感器，例如，设置适合您应用需求的采样频率。\u003C\u002Fli\u003E\n\u003Cli\u003E您可以检测平台上是否有对应传感器。\u003C\u002Fli\u003E\n\u003Cli\u003E传感器读数具有高精度时间戳，可以更好地与应用程序中的其他活动同步。\u003C\u002Fli\u003E\n\u003Cli\u003E传感器数据模型和坐标系统明确定义，允许浏览器供应商实现可互操作的解决方案。\u003C\u002Fli\u003E\n\u003Cli\u003EGeneric Sensor 的基础接口没有绑定到 DOM（Navigator 和 Window 对象），为将来在 Service Workers 中使用相同的 API 或在 Headless JS 运行时实现 Generic Sensor API（例如在嵌入式设备上）开辟了的机会。\u003C\u002Fli\u003E\n\u003Cli\u003E与传统的传感器API相比，安全性和隐私方面是 Generic Sensor API 的首要任务，并且提供了更好的安全级别。目前已经集成了 Permissions API。\u003C\u002Fli\u003E\n\u003Cli\u003E自动的屏幕坐标同步目前可于 Accelerometer，Gyroscope，LinearAccelerationSensor，AbsoluteOrientationSensor，RelativeOrientationSensor和Magnetometer。\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp\u003EChrome 支持以下几种传感器。\u003C\u002Fp\u003E\n\u003Ch2 id=\"运动传感器motion-sensors\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#运动传感器motion-sensors\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E运动传感器（Motion sensors）\u003C\u002Fh2\u003E\n\u003Cul\u003E\u003Cli\u003E加速度计（Accelerometer）\u003C\u002Fli\u003E\n\u003Cli\u003E陀螺仪（Gyroscope)\u003C\u002Fli\u003E\n\u003Cli\u003E线性加速度传感器（LinearAccelerationSensor）\u003C\u002Fli\u003E\n\u003Cli\u003E绝对方向传感器（AbsoluteOrientationSensor）\u003C\u002Fli\u003E\n\u003Cli\u003E相对方向传感器（RelativeOrientationSensor）\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Ch2 id=\"环境传感器environmental-sensors\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#环境传感器environmental-sensors\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E环境传感器（Environmental sensors）\u003C\u002Fh2\u003E\n\u003Cul\u003E\u003Cli\u003E环境光传感器（AmbientLightSensor）\u003C\u002Fli\u003E\n\u003Cli\u003E磁力计（Magnetometer）\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp\u003E您可以通过打开功能标志 chrome:\u002F\u002Fflags\u002F#enable-generic-sensor-extra-classes 来启用环境传感器API以用于开发目的。\u003C\u002Fp\u003E\n\u003Cp\u003E如需了解浏览器实现状态的更多信息，请访问 \u003Ca href=\"https:\u002F\u002Fchromestatus.com\u002Ffeature\u002F5298357018820608\" rel=\"nofollow\"\u003Echromestatus.com\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\n\u003Ch2 id=\"这些传感器是什么我们如何使用它们\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#这些传感器是什么我们如何使用它们\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E这些传感器是什么？我们如何使用它们？\u003C\u002Fh2\u003E\n\u003Cp\u003E传感器是一个相当特殊的领域，可能需要简单介绍。如果您熟悉传感器，则可以直接跳到开始编码章节。否则，我们来详细了解每个支持的传感器。\u003C\u002Fp\u003E\n\u003Ch2 id=\"加速度和线性加速度\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#加速度和线性加速度\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E加速度和线性加速度\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fimages\u002Fblog\u002F20220706\u002F1.gif\" alt=\"测量加速度传感器\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E图1: 测量加速度传感器\u003C\u002Fp\u003E\n\u003Cp\u003E加速度传感器测量三个轴（X，Y 和 Z）上承载传感器的设备的加速度。这个传感器是一个惯性传感器，这意味着当设备处于线性自由落体时，总测得的加速度为 0m\u002Fs2，当一个设备平躺在桌子上时，向上方向（Z轴）的加速度将会等于地球的重力，即 g≈+9.8m\u002Fs2，因为它测量的是桌子向上推动设备的力。如果将设备推向右侧，则X轴上的加速度为正，如果设备从右侧加速至左侧，则加速度为负。\u003C\u002Fp\u003E\n\u003Cp\u003E加速度计可用于如下步骤：步数计算，动作感应或简单的设备定向。通常情况下，加速度计测量结合其他来源的数据，以创建融合传感器，如方向传感器。\u003C\u002Fp\u003E\n\u003Cp\u003E线性加速度传感器测量装置传感器的设备的加速度，不包括的重力的作用。例如，当设备处于静止状态时，传感器在三个轴上测量的加速度 ≈0m\u002F2。\u003C\u002Fp\u003E\n\u003Ch2 id=\"陀螺仪\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#陀螺仪\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E陀螺仪\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fimages\u002Fblog\u002F20220706\u002F2.gif\" alt=\"测量陀螺仪传感器\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E图2: 测量陀螺仪传感器\u003C\u002Fp\u003E\n\u003Cp\u003E陀螺仪传感器测量设备在偏转，倾斜时相对于 X，Y 和 Z 轴的角速度（rad\u002Fs）。大多数消费类设备都有机械（MEMS）陀螺仪，它们是基于惯性科里奥利力来测量旋转速率的惯性传感器。MEMS 陀螺仪容易产生漂移，这是由传感器的重力灵敏度引起的，这会使传感器的内部机械系统变形。陀螺仪以相对高的频率振荡，例如 10kHz，因此与其他传感器相比可能消耗更多的功率。\u003C\u002Fp\u003E\n\u003Ch2 id=\"方向传感器\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#方向传感器\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E方向传感器\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fimages\u002Fblog\u002F20220706\u002F3.gif\" alt=\"测量绝对方向传感器\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E图3: 测量绝对方向传感器\u003C\u002Fp\u003E\n\u003Cp\u003E绝对方向传感器是一种的融合传感器，测量设备相对于地球坐标系的旋转，而相对方向传感器则提供设备相对于固定的参考坐标系统的旋转数据。\u003C\u002Fp\u003E\n\u003Cp\u003E所有现代 3D JavaScript 框架均支持四元数和旋转矩阵来表示旋转。但是，如果你直接使用 WebGL，方向传感器接口提供了便捷的方法用于 WebGL 兼容的旋转矩阵。这里有几个代码示例：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-js\"\u003Ethree\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Ejs\n\n\u003Cspan class=\"token keyword\"\u003Elet\u003C\u002Fspan\u003E torusGeometry \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003ETHREE\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ETorusGeometry\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E7\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1.6\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E6.3\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Elet\u003C\u002Fspan\u003E material \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003ETHREE\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EMeshBasicMaterial\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E \u003Cspan class=\"token literal-property property\"\u003Ecolor\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0x0071C5\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Elet\u003C\u002Fspan\u003E torus \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003ETHREE\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EMesh\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EtorusGeometry\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E material\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\nscene\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Etorus\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F 使用四元数更新网格旋转。\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E sensorAbs \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EAbsoluteOrientationSensor\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\nsensorAbs\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function-variable function\"\u003Eonreading\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E torus\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Equaternion\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EfromArray\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EsensorAbs\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Equaternion\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\nsensorAbs\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Estart\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F 使用旋转矩阵更新网格旋转。\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E sensorRel \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003ERelativeOrientationSensor\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Elet\u003C\u002Fspan\u003E rotationMatrix \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EFloat32Array\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E16\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\nsensor_rel\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function-variable function\"\u003Eonreading\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n  sensorRel\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EpopulateMatrix\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003ErotationMatrix\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  torus\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Ematrix\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EfromArray\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003ErotationMatrix\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\nsensorRel\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Estart\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cpre class=\"language-js\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token constant\"\u003EBABYLON\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E mesh \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EBABYLON\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EMesh\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ECreateCylinder\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"mesh\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0.9\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0.3\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0.6\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E9\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E scene\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E sensorRel \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003ERelativeOrientationSensor\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\"token literal-property property\"\u003Efrequency\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E30\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\nsensorRel\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function-variable function\"\u003Eonreading\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E mesh\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ErotationQuaternion\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EFromArray\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EsensorRel\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Equaternion\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\nsensorRel\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Estart\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cpre class=\"language-js\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-js\"\u003EWebGL\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F 当有新的读数时，初始化传感器和更新模型矩阵。\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Elet\u003C\u002Fspan\u003E modMatrix \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EFloat32Array\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E sensorAbs \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EAbsoluteOrientationSensor\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\"token literal-property property\"\u003Efrequency\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E60\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\nsensorAbs\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function-variable function\"\u003Eonreading\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E sensorAbs\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EpopulateMatrix\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EmodMatrix\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\nsensorAbs\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Estart\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F Somewhere in rendering code, update vertex shader attribute for the model\u003C\u002Fspan\u003E\ngl\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EuniformMatrix4fv\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EmodMatrixAttr\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Efalse\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E modMatrix\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E方向传感器支持各种用例，如沉浸式游戏，AR 和 VR。\u003C\u002Fp\u003E\n\u003Cp\u003E如果你想了解运动传感器的更多信息，比如高级用例和需求说明等，请参考运动传感器解释文档。\u003C\u002Fp\u003E\n\u003Ch2 id=\"屏幕坐标系同步\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#屏幕坐标系同步\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E屏幕坐标系同步\u003C\u002Fh2\u003E\n\u003Cp\u003E默认情况下，空间传感器的读数将在绑定到设备的本地坐标系中解析，并且不考虑屏幕方向。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fimages\u002Fblog\u002F20220706\u002F4.png\" alt=\"设备坐标系\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E图4: 设备坐标系\u003C\u002Fp\u003E\n\u003Cp\u003E但是，许多使用案例（如游戏，AR 和 VR）都需要传感器读数在绑定于屏幕方向的坐标系中解析。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fimages\u002Fblog\u002F20220706\u002F5.png\" alt=\"屏幕坐标系\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E图5: 屏幕坐标系\u003C\u002Fp\u003E\n\u003Cp\u003E以前，传感器读数重新映射到屏幕坐标必须在 JavaScript 中实现。这种方法效率低下，并且也极大地增加了 Web 应用程序代码的复杂性：Web 应用程序必须监视屏幕方向更改并执行传感器读数的坐标转换，这对欧拉角或四元数来说并不是简单的事情。\u003C\u002Fp\u003E\n\u003Cp\u003EGeneric Sensor API 提供了更简单可靠的解决方案！本地坐标系对于所有定义的空间传感器类都是可配置的： Accelerometer、Gyroscope、LinearAccelerationSensor、AbsoluteOrientationSensor、RelativeOrientationSensor 和 Magnetometer。通过将 referenceFrame 选项传递给传感器对象构造函数，用户可以定义返回的读数是否将在设备或屏幕坐标中解析。\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token comment\"\u003E\u002F\u002F 当有新的读数时，初始化传感器和更新模型矩阵。\u003C\u002Fspan\u003E\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F 或者,可以写成 RelativeOrientationSensor(&#123;referenceFrame: \"device\"&#125;).\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E sensorRelDevice \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003ERelativeOrientationSensor\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F 传感器读数在屏幕坐标系统中得到解析。不需要手动重新映射！\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E sensorRelScreen \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003ERelativeOrientationSensor\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\"token literal-property property\"\u003EreferenceFrame\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"screen\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"开始编码\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#开始编码\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E开始编码!\u003C\u002Fh2\u003E\n\u003Cp\u003EGeneric Sensor API 非常容易上手！Sensor 接口提供了 start() 和 stop() 方法来控制传感器状态和事件处理用于接收传感器状态，错误和新的可用的读数的通知。具体的传感器类通常将其特定的读取属性添加到基类里。\u003C\u002Fp\u003E\n\u003Ch2 id=\"开发环境\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#开发环境\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E开发环境\u003C\u002Fh2\u003E\n\u003Cp\u003E在开发过程中，您可以通过 localhost 去使用 Sensor 接口，最简单的方法是使用 Web Server for Chrome 来为您的 Web 应用程序提供服务。如果您是在移动设备上开发，需要为本地服务器设置端口转发，然后你就可以开始编码了！\u003C\u002Fp\u003E\n\u003Cp\u003E当您的代码准备好后，将其部署在支持 HTTPS 的服务器上。GitHub Pages 可以提供 HTTPS 服务，将是您分享 Demo 的好地方。\u003C\u002Fp\u003E\n\u003Ch2 id=\"3d-模型旋转\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#3d-模型旋转\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E3D 模型旋转\u003C\u002Fh2\u003E\n\u003Cp\u003E在下列简单的例子中，我们使用绝对方向传感器的数据来修改 3D 模型的旋转四元数。代码中的 model 是 three.js 的 Object3D 类的一个实例，具有 quaternion 属性。手机定向 demo 中的以下代码片段解释了绝对定位传感器如何用于旋转 3D 模型。\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EinitSensor\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n  sensor \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EAbsoluteOrientationSensor\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\"token literal-property property\"\u003Efrequency\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E60\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  sensor\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function-variable function\"\u003Eonreading\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E model\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Equaternion\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EfromArray\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Esensor\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Equaternion\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  sensor\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function-variable function\"\u003Eonerror\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token parameter\"\u003Eevent\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eevent\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eerror\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Ename \u003Cspan class=\"token operator\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'NotReadableError'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n      console\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"Sensor is not available.\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n  sensor\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Estart\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E设备的方向将反映在 model 的 3D 旋转的 WebGL 场景内。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fimages\u002Fblog\u002F20220706\u002F6.png\" alt=\"传感器更新3D模型的方向\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E图6: 传感器更新 3D 模型的方向\u003C\u002Fp\u003E\n\u003Ch2 id=\"punchmeter\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#punchmeter\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EPunchmeter\u003C\u002Fh2\u003E\n\u003Cp\u003E下面的代码片段是从 punchmeter demo 提取出来的，解释了如何使用线性加速度传感器来计算设备在初始化为静止状态的最大速度。\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EmaxSpeed \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Evx \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eax \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Et \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Eonreading\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token keyword\"\u003Elet\u003C\u002Fspan\u003E dt \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eaccel\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Etimestamp \u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Et\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0.001\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"token comment\"\u003E\u002F\u002F In seconds\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Evx \u003Cspan class=\"token operator\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eaccel\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Ex \u003Cspan class=\"token operator\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eax\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003E dt\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token keyword\"\u003Elet\u003C\u002Fspan\u003E speed \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E Math\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Eabs\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Evx\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EmaxSpeed \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E speed\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EmaxSpeed \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E speed\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Et \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eaccel\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Etimestamp\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eax \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eaccel\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Ex\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token operator\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eaccel\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EaddEventListener\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'reading'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E onreading\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E当前速度计算为近似加速度函数的积分。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fimages\u002Fblog\u002F20220706\u002F7.png\" alt=\"测量冲压速度\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E图7: 测量冲压速度\u003C\u002Fp\u003E\n\u003Ch2 id=\"隐私和安全\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#隐私和安全\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E隐私和安全\u003C\u002Fh2\u003E\n\u003Cp\u003E传感器读数是敏感数据，可能受到来自恶意网页的各种攻击。Chrome 对 Generic Sensor API 的实现做了一些限制，以减轻潜在的安全和隐私风险。打算使用 Generic Sensor API 的开发人员必须考虑到这些限制，下面让我们简单地列出它们。\u003C\u002Fp\u003E\n\u003Ch2 id=\"只允许运行在-https\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#只允许运行在-https\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E只允许运行在 HTTPS\u003C\u002Fh2\u003E\n\u003Cp\u003E由于 Generic Sensor API 是一项强大的功能，因此 Chrome 只允许在安全的情况下使用。实际上，这意味着要使用 Generic Sensor API，您需要通过HTTPS访问您的页面。在开发过程中，您可以通过http:\u002F\u002Flocalhost 进行此操作，但对于最终产品，您需要在服务器上部署 HTTPS。\u003C\u002Fp\u003E\n\u003Ch2 id=\"feature-policy-集成\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#feature-policy-集成\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EFeature Policy 集成\u003C\u002Fh2\u003E\n\u003Cp\u003EGeneric Sensor API 集成了 Feature Policy 用于控制在 frame 上访问传感器数据。\u003C\u002Fp\u003E\n\u003Cp\u003E默认情况下，Sensor 对象只允许在主 frame 或同一个域的子 frame 内创建，从而防止未经授权的跨域 iframe 读取传感器数据。您还可以通过明确地启用或禁用相应的策略控制功能来修改此默认行为。\u003C\u002Fp\u003E\n\u003Cp\u003E下面的代码片段说明了如何授予加速度计数据访问跨域 iframe 的权限，这意味着 Accelerometer 或 LinearAccelerationSensor 对象可以在跨域 iframe 里创建。\u003C\u002Fp\u003E\n\u003Cpre class=\"language-html\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-html\"\u003E\u003Cspan class=\"token tag\"\u003E\u003Cspan class=\"token tag\"\u003E\u003Cspan class=\"token punctuation\"\u003E&lt;\u003C\u002Fspan\u003Eiframe\u003C\u002Fspan\u003E \u003Cspan class=\"token attr-name\"\u003Esrc\u003C\u002Fspan\u003E\u003Cspan class=\"token attr-value\"\u003E\u003Cspan class=\"token punctuation attr-equals\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E\"\u003C\u002Fspan\u003Ehttps:\u002F\u002Fthird-party.com\u003Cspan class=\"token punctuation\"\u003E\"\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token attr-name\"\u003Eallow\u003C\u002Fspan\u003E\u003Cspan class=\"token attr-value\"\u003E\u003Cspan class=\"token punctuation attr-equals\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E\"\u003C\u002Fspan\u003Eaccelerometer\u003Cspan class=\"token punctuation\"\u003E\"\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E\u002F\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E备注: Feature Policy 集成在 Chrome 65 或更高版本中。在早期版本的 Chrome 中，Sensor 对象只能在主 frame 内创建。\u003C\u002Fp\u003E\n\u003Cp\u003E传感器读数传送可以被暂停。\u003C\u002Fp\u003E\n\u003Cp\u003E传感器读数只能通过可见网页访问，即用户实际上正在与之交互时。而且，如果用户聚焦到跨域子 frame 传感器读数传送将会在父页面上被暂停，以防止在跨域子 frame 中的第三方软件窃取到用户信息。\u003C\u002Fp\u003E\n\u003Cp\u003E由于 Generic Sensor 框架具有很强的可扩展性，我们可以预见更多代表各种传感器类型的新类的出现，并为 PWA 及 Web 带来更多功能。\u003C\u002Fp\u003E\n\u003Cul\u003E\u003Cli\u003E英文作者：Alexander Shalamov, Mikhail Pozdnyakov \u002F 英特尔\u003C\u002Fli\u003E\n\u003Cli\u003E译者：林万铭\n\u003C\u002Fli\u003E\u003C\u002Ful\u003E",meta:{title:"Web 通用传感器 (Generic Sensors)",date:"2018-04-08",updated:"2022-07-06",categories:["DevDay","PWA","Fugu","Sensor"],coverImage:"\u002Fimages\u002Fblog\u002F20220706\u002F4.png",coverWidth:16,coverHeight:9,excerpt:"今天，传感器数据被用于许多原生应用程序，以实现诸如沉浸式游戏，健身追踪，AR，VR 等用例。如果能有一个 Web 传感器 API 去缩小原生和 Web 应用程序之间的差距是不是很酷？Generic Sensor API，就是为 Web 而诞生的！Generic Sensor API 提供了一套接口把传感器设备暴露到 Web 平台。该 API 由基础 Sensor 接口和一组构建于上方的具体传感器类组成。拥有基础接口可以简化具体传感器类的实现和规范流程。",author:"林万铭",authorTitle:"软件工程师",authorCompany:"英特尔 SATG Web 平台工程",authorImg:"\u002Fimages\u002Fpeople\u002F120\u002Fwanming.png",author2:a,authorTitle2:a,authorCompany2:a,authorImg2:a,author3:a,authorTitle3:a,authorCompany3:a,authorImg3:a,slug:"generic-sensors"}},uses:{dependencies:b,params:["post"],parent:b,url:b}}]}("",void 0)),
				form: null
			},
			paths: {"base":"","assets":""},
			target: document.querySelector('[data-sveltekit-hydrate="k888ce"]').parentNode,
			trailing_slash: "never"
		});
	</script>
	</div>
		<script>
			const showStatus = async () => {
				if (!window.queryLocalFonts) {
					console.log('queryLocalFonts() 不存在');
					// this.enabled = false;
					return;
				} else {
					// this.enabled = true;
					console.log('queryLocalFonts() 可用');
				}
				
				const status = await navigator.permissions.query({ name: "local-fonts" });
				let statusMessage;
				if (status.state === "granted")
					statusMessage = '已授予权限 👍';
				else if (status.state === "prompt")
					statusMessage = '将要请求权限';
				else
					statusMessage = '权限被拒绝 👎';
					
				console.log(statusMessage); 
			}

			const localFontAccess = async () => {
				try {
					const array = await self.queryLocalFonts({postscriptNames: ['FangSong', 'KaiTi', 'SegoeUI']});
					let styles = ``;
					array.forEach(font => {
						console.log(`Access granted for ${font.postscriptName}`);
						styles += `
						@font-face {
							font-family: ${font.postscriptName};
							src: local("${font.postscriptName}");
						}`;
					});

					console.log(`${styles}`);

					let css = document.createElement('style');
					css.id = 'df';
					css.type = 'text/css';
					
					if (css.styleSheet)
						css.styleSheet.cssText = styles;
					else
						css.appendChild(document.createTextNode(styles));
					document.querySelectorAll('head')[0].appendChild(css);    
				} catch(e) {
					// Handle error. It could be a permission error.
					console.warn(`Local font access not available: ${e.message}`);
				}
			}
			document.addEventListener('DOMContentLoaded', localFontAccess, false);
		</script>
		<script type="module">
			if ('serviceWorker' in navigator) {
				navigator.serviceWorker.register('/sw.js').then((registration) => {
					console.log('Service worker registration succeeded:', registration);
				}, (error) => {
					console.error(`Service worker registration failed: ${error}`);
				});
			} else {
				console.error('Service workers are not supported.');
			}
		</script>
	</body>
</html>
